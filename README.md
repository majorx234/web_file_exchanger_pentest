# Info
- WIP
- documentation on build process of VM
- build a container/vm infrastucture to test web application
- web application: https://github.com/majorx234/web_file_exchanger
- pentesting afterwards

## Build container
- create container with toolchain to build rust executeables
- build static application
### build application
- ToDo: documentaion

## Package
- archlinux package
- good for ci/cd
- in folder `web_file_exchanger_PKGBUILD`
- creates `web_file_exchanger-X.X.X-X-x86_64.pkg.tar.zst`

## VM
- virtual machine to have some kind of black box for pentesting
### Building VM
- create rootfs image:
  - `qemu-img create -f raw vm_web_file_exchanger.raw 5G`
  - `mkfs.ext4 vm_web_file_exchanger.raw`
  - `mkdir /mnt/vm_web_file_exchanger`
  - `sudo mount vm_web_file_exchanger.raw /mnt/vm_web_file_exchanger`
  - `sudo pacstrap /mnt/vm_web_file_exchanger base base-devel`
  - create non-root user: `useradd -m -g users -s /bin/bash horst`
- install web_file_exchanger
  - copy `web_file_exchanger-X.X.X-X-x86_64.pkg.tar.zst` to `/mnt/vm_web_file_exchanger`
  - `sudo arch-chroot /mnt/vm_web_file_exchanger`
  - `pacman -U web_file_exchanger-X.X.X-X-x86_64.pkg.tar.zst`
  - `rm web_file_exchanger-X.X.X-X-x86_64.pkg.tar.zst`
  - edit: `/etc/systemd/system/web_file_exchanger.service`
    - change username in line: `User=horst`
  - `chown horst:users /usr/share/web_file_exchanger/file_store/`
  - `systemctl enable web_file_exchanger.service`
  - exit chroot environment: `exit`
  - `sudo umount /mnt/vm_web_file_exchanger`
- build kernel (needed for simple qemu VM run):
  - `git clone --depth=1 git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git`
  - `cd linux`
  - `make x86_64_defconfig`
  - `make kvm_guest.config`
  - `make -j8`
  - at the end you've got a `bzImage`
### run VM
- with rootfs (`vm_web_file_exchanger.raw` and `bzImage`) it is possible to run VM with Qemu:
  - `qemu-system-x86_64 -hda ./vm_web_file_exchanger.raw -m 4G -smp 1 -nographic -kernel ./bzImage -append "root=/dev/sda rw console=ttyS0 loglevel=5" --enable-kvm -nic user,hostfwd=tcp::8080-:8080`
    - `-m` - defines 4GiB Ram
    - `-hda` - defines rootfs drive
    - `-smp 1` - set virtual cpus to 1
    - `-nographic` - only console output
    - `-kernel` - set kernel image to use
    - `-append` - set kernel arguments
    - `--enable-kvm` - kvm accelration (optional)
    - `-nic user,hostfwd=tcp::8080-:8080` - port forwarding to hosts port 8080 
